import React, { useEffect } from "react";
import fs from "fs";
import matter from "gray-matter";
import PageTransition from "@/components/PageTransition";
import { albumCategories, folderNames } from "@/lib/consts";
import { ContentLayout } from "@/components/ContentLayout";
import { FixedFooter } from "@/components/FixedFooter";
import Link from "next/link";
import { AlbumsArchive } from "@/components/AlbumsArchive/AlbumsArchive";

export async function getStaticProps() {
    const files = fs.readdirSync(folderNames.albums);
    const markdownPosts = files.filter((file) => file.endsWith(".md"));

    const albums = markdownPosts.map((fileName) => {
        const slug = fileName.replace(".md", "");
        const readFile = fs.readFileSync(
            `${folderNames.albums}${fileName}`,
            "utf8"
        );
        const { data: contents } = matter(readFile);

        return {
            slug,
            contents,
        };
    });

    return {
        props: {
            albums,
        },
    };
}

const Albums = ({ albums }: any) => {
    return (
        <PageTransition>
            <ContentLayout className="pt-28">
                <div className="container mb-10">
                    <div className="heading--container relative">
                        <h1 className="absolute leading-[1] tracking-[-5px] left-0 top-1/2 -translate-y-1/2 text-[130px] font-bold">
                            Albums
                            <span className="absolute -right-8 -top-0 text-[35px] tracking-tighter">
                                0{albums.length}
                            </span>
                        </h1>
                        <svg
                            width="100%"
                            height="294"
                            viewBox="0 0 1356 294"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                            className=" text-[#F8F8F8]"
                        >
                            <path
                                d="M0.397 290L96.868 0.586987H184.208L280.679 290H216.365L196.912 230.45H84.164L64.711 290H0.397ZM98.456 183.207H182.62L158.006 109.365L141.729 56.564H139.347L123.07 109.365L98.456 183.207ZM290.21 290V77.208H343.011L345.393 111.35H347.378C352.142 97.5873 359.685 88.0593 370.007 82.766C380.594 77.208 392.636 74.429 406.134 74.429C408.516 74.429 410.633 74.429 412.486 74.429C414.339 74.429 416.191 74.429 418.044 74.429V129.215C416.721 129.215 414.868 129.215 412.486 129.215C410.104 129.215 407.59 129.215 404.943 129.215C391.974 129.215 381.388 131.2 373.183 135.17C364.978 138.875 358.891 144.433 354.921 151.844C350.951 159.255 348.834 168.253 348.569 178.84V290H290.21ZM521.531 293.573C505.651 293.573 491.226 291.059 478.258 286.03C465.289 280.737 454.041 273.194 444.513 263.401C435.249 253.608 428.103 241.963 423.075 228.465C418.311 214.967 415.929 200.013 415.929 183.604C415.929 161.107 420.296 141.654 429.03 125.245C437.764 108.836 450.203 96.1317 466.348 87.133C482.492 77.8697 501.548 73.238 523.516 73.238C541.778 73.238 557.923 76.6787 571.95 83.56C586.242 90.4413 597.623 99.9693 606.092 112.144C614.561 124.319 619.193 138.478 619.987 154.623H562.819C561.76 147.212 559.246 140.993 555.276 135.964C551.571 130.935 546.807 127.23 540.984 124.848C535.426 122.201 529.074 120.878 521.928 120.878C511.87 120.878 503.269 123.525 496.123 128.818C488.977 133.847 483.683 141.125 480.243 150.653C476.802 159.916 475.082 170.9 475.082 183.604C475.082 197.631 476.934 209.277 480.64 218.54C484.61 227.539 490.035 234.42 496.917 239.184C504.063 243.683 512.268 245.933 521.531 245.933C530 245.933 537.146 244.477 542.969 241.566C549.056 238.655 553.82 234.552 557.261 229.259C560.966 223.966 563.084 218.011 563.613 211.394H620.384C619.59 228.068 614.826 242.625 606.092 255.064C597.623 267.239 586.109 276.767 571.553 283.648C556.996 290.265 540.322 293.573 521.531 293.573ZM640.33 290V0.586987H698.689V115.717H701.071C706.894 101.425 715.892 90.8383 728.067 83.957C740.242 76.811 753.872 73.238 768.958 73.238C779.545 73.238 789.337 74.9583 798.336 78.399C807.599 81.575 815.539 86.6037 822.156 93.485C829.037 100.366 834.331 109.497 838.036 120.878C842.006 131.994 843.991 145.492 843.991 161.372V290H785.632V174.076C785.632 162.166 784.176 152.241 781.265 144.301C778.618 136.361 774.384 130.538 768.561 126.833C762.738 122.863 755.063 120.878 745.535 120.878C735.478 120.878 727.008 123.26 720.127 128.024C713.246 132.788 707.952 139.008 704.247 146.683C700.542 154.358 698.689 162.695 698.689 171.694V290H640.33ZM876.064 290V77.208H934.423V290H876.064ZM876.064 49.815V0.586987H934.423V49.815H876.064ZM1015.98 290L943.331 76.811H1006.06L1038.21 190.75L1050.92 241.566H1052.9L1065.61 191.147L1097.76 76.811H1160.89L1088.63 290H1015.98ZM1254.31 293.97C1232.08 293.97 1213.15 289.471 1197.54 280.472C1182.19 271.473 1170.41 258.769 1162.21 242.36C1154 225.951 1149.9 206.895 1149.9 185.192C1149.9 162.166 1154 142.316 1162.21 125.642C1170.67 108.968 1182.45 96.1317 1197.54 87.133C1212.89 77.8697 1231.02 73.238 1251.93 73.238C1276.28 73.238 1296.13 78.5313 1311.48 89.118C1327.09 99.7047 1338.34 114.261 1345.22 132.788C1352.1 151.315 1354.35 172.488 1351.97 196.308H1207.07C1207.07 207.953 1208.92 217.878 1212.62 226.083C1216.59 234.023 1222.15 239.978 1229.3 243.948C1236.44 247.918 1244.78 249.903 1254.31 249.903C1265.16 249.903 1274.29 247.389 1281.7 242.36C1289.11 237.331 1293.88 230.715 1295.99 222.51H1350.78C1349.19 237.067 1344.03 249.771 1335.3 260.622C1326.56 271.209 1315.18 279.413 1301.16 285.236C1287.39 291.059 1271.78 293.97 1254.31 293.97ZM1207.07 165.739L1201.91 160.181H1300.36L1294.8 165.739C1295.33 154.623 1293.74 145.624 1290.04 138.743C1286.6 131.597 1281.57 126.171 1274.95 122.466C1268.6 118.761 1260.93 116.908 1251.93 116.908C1242.93 116.908 1234.99 118.893 1228.11 122.863C1221.49 126.568 1216.33 132.126 1212.62 139.537C1209.18 146.683 1207.33 155.417 1207.07 165.739Z"
                                fill="currentColor"
                            />
                        </svg>
                    </div>
                </div>

                <AlbumsArchive albums={albums} categories={albumCategories} />

                <div className="w-full min-h-screen"></div>
            </ContentLayout>

            <FixedFooter>
                <div className="w-full h-full flex items-center justify-center">
                    <h1 className="text-[150px] text-white font-bold">
                        Footer
                    </h1>
                </div>
            </FixedFooter>
        </PageTransition>
    );
};

export default Albums;
